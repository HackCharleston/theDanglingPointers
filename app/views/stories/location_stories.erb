<div class='row-fluid'>
 <div class='span12 '>
    <h2>Location Title</h2>
    <p>
      Location Address
    </p>

    <h1>
      <%= link_to "/stories/new/#{@lat}/#{@long}" do %>
        <i class="fa fa-plus-circle fa-2x"></i>
      <% end %>
      My Stories
    </h1>

    <ul class="media-list">
      <% @stories.each do |story| %>
        <li class="media">
          <%= link_to "/stories/#{story.id}" do %>
            <span class="fa-stack fa-lg media-object pull-left">
              <i class="fa fa-square fa-stack-2x"></i>
              <i class="fa fa-film fa-stack-1x fa-inverse"></i>
            </span>
          <% end %>
          <%= link_to story, method: :delete, data: { confirm: 'Are you sure?' } do %>
            <span class="fa-stack fa-lg media-object pull-left">
              <i class="fa fa-square fa-stack-2x"></i>
              <i class="fa fa-trash-o fa-stack-1x fa-inverse"></i>
            </span>
          <% end %>
          <%= link_to "/stories/#{story.id}" do %>
            <div class="media-body">
              <h4 class="media-heading"><%= story.title %></h4>
            </div>
          <% end %>
        </li>
      <% end %>
        </div>
      </li>
    </ul>

    <h3>Other People's Stories</h3>
    <ul>
      <li>this</li>
      <li>is</li>
      <li>a</li>
      <li>story</li>
      <li>list</li>
    </ul>
    <style>
    html, body, #map-canvas {
      height: 100%;
      margin: 0px;
      padding: 0px
    }
    </style>
    <!-- <script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyDJLcKc7OSbrmFN6agLkDrF3-r-lburzhk&sensor=true&restuarant=places"></script>  -->
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=places&sensor=false&key=AIzaSyDJLcKc7OSbrmFN6agLkDrF3-r-lburzhk"></script>

    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/place/textsearch/json?query=parks+in+charleston+south+carolina&sensor=false&key=AIzaSyDJLcKc7OSbrmFN6agLkDrF3-r-lburzhk"></script>
    <script type="text/javascript" src="infobox.js"></script>
    <script>
    var map;
    var service;
    var marker;
    var pos;
    var infowindow;
    var results = [];


    function initialize() {
      //alert('yo');
      var mapOptions = {
        zoom: 15
      };

      map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
      //console.log(map);

      // Try HTML5 geolocation
      if (navigator.geolocation) {
        //alert('go go geo');
        navigator.geolocation.getCurrentPosition(function(position) {
          pos = new google.maps.LatLng(position.coords.latitude,
            position.coords.longitude);
            window.longi = position.coords.longitude;
            window.lati = position.coords.latitude;
          infowindow = new google.maps.InfoWindow({
            map: map,
            position: pos,
            content: 'You Are Here.'
          });

          map.setCenter(pos);

          var request = {
            location: pos,
            radius: 20000,
            types: ['park']
          };

          infowindow = new google.maps.InfoWindow();
          var service = new google.maps.places.PlacesService(map);
          service.nearbySearch(request, callback);
        }, function() {
          handleNoGeolocation(true);
        });
      } else {
        // Browser doesn't support Geolocation
        handleNoGeolocation(false);
      }

      // function callback(results, status) {
      //   alert('here i am');
      //     if (status == google.maps.places.PlacesServiceStatus.OK) {
      //         for (var i = 0; i < results.length; i++) {
      //             console.log('after / to createMarker');
      //             createMarker(results[i]);
      //         }
      //     }
      // }

      function callback(results, status) {
        if (status == google.maps.places.PlacesServiceStatus.OK) {
          for (var i = 0; i < results.length; i++) {
            var place = results[i];
            createMarker(results[i]);
            //alert(results[i]); >> object Object

          }
          //console.dir(results);
        }
      }
    }

    function performSearch() {
      alert('perform seach');
      var request = {
        bounds: map.getBounds(),
        location: pos
      };
      service.textSearch(request, callback);
    }

    // function callback(results, status) {
    //   if (status != google.maps.places.PlacesServiceStatus.OK) {
    //     alert(status);
    //     return;
    //   }
    //   for (var i = 0, result; result = results[i]; i++) {
    //     createMarker(result);
    //   }
    // }

    function createMarker(place) {
      var marker = new google.maps.Marker({
        map: map,
        position: place.geometry.location,
        icon: {
          //Star
          path: 'M 0,-24 6,-7 24,-7 10,4 15,21 0,11 -15,21 -10,4 -24,-7 -6,-7 z',
          fillColor: '#f25518',
          fillOpacity: 1,
          scale: 1/2,
          strokeColor: '#222222',
          strokeWeight: 2
          //url: 'http://www.lolt.org/images/header/logo.png'
        }
      });

      google.maps.event.addListener(marker, 'click', function() {

      //   service.getDetails(place, function(result, status) {
      //     if (status != google.maps.places.PlacesServiceStatus.OK) {
      //       alert(status);
      //       return;
      //     }
      //     infoWindow.setContent(result.name);
      //     infoWindow.open(map, marker);
      //   });
      // window.location.href = 'http://location/long/lat';
      });


    var contentString = '<div id="content">'+
        '<div id="siteNotice">'+
        '</div>'+
        '<p>Attribution: Uluru, <a href=/location/' + window.longi + '/' + window.lati + '>' +
        'http://en.wikipedia.org/w/index.php?title=Uluru</a> '+
        '(last visited June 22, 2009).</p>'+
        '</div>'+
        '</div>';

    var infowindow = new google.maps.InfoWindow({
        content: contentString
    });

    google.maps.event.addListener(marker, 'click', function() {
      infowindow.open(map,marker);
    });
  }

  // function createMarker(place) {
  //     var placeLoc = place.geometry.location;
  //     var marker = new google.maps.Marker({
  //       map: map,
  //       position: place.geometry.location
  //     });

  //     var request = { reference: place.reference };
  //     service.getDetails(request, function(details, status) {
  //       google.maps.event.addListener(marker, 'click', function() {
  //         infowindow.setContent(details.name + "<br />" + details.formatted_address +"<br />" + details.website + "<br />" + details.rating + "<br />" + details.formatted_phone_number);
  //         infowindow.open(map, this);
  //       });
  //     });
  //   }


    google.maps.event.addDomListener(window, 'load', initialize);
    </script>

<div id="map-canvas"></div>
 </div>
</div>
